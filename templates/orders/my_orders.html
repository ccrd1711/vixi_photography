{% extends "base.html" %}
{% block title %}My Orders{% endblock %}
{% block content %}

<h1>My Orders</h1>

{% for o in orders %}
  <div class="order-card">
    <h2>Order #{{ o.id }} - {{ o.created_at|date:"Y-m-d H:i" }}</h2>
    <p>Status: {{ o.status }}</p>

    <table class="cart-table">
      <thead>
        <tr><th>Photo</th><th>Qty</th><th>Line Total</th><th>Actions</th></tr>
      </thead>
      <tbody>
        {% for item in o.items.all %}
          <tr>
            <td>{{ item.photo }}</td>
            <td>{{ item.qty }}</td>
            <td>{{ item.subtotal_display }}</td>
            <td>
              {% if o.status == "paid" %}
                <a href="{% url 'orderitem_download' item.id %}">Download</a>
              {% else %}
                <span>Available after payment</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Order Total: {{ o.total_display }}</strong></p>
  </div>
{% empty %}
  <p>You have no orders yet.</p>
{% endfor %}

{% endblock %}
