{% extends "base.html" %}
{% block title %}My Orders{% endblock %}
{% block content %}

<h1>My Orders</h1>

{% for o in orders %}
  <div class="order-card">
    <h2>Order #{{ o.id }} - {{ o.created_at|date:"Y-m-d H:i" }}</h2>

    <table class="cart-table">
      <thead>
        <tr>
          <th>Photo</th>
          <th>Variant</th>
          <th>Qty</th>
          <th>Line Total</th>
          <th>Download</th>
        </tr>
      </thead>
      <tbody>
        {% for item in o.items.all %}
          <tr>
            <td>{{ item.photo.title }}</td>
            <td>{{ item.get_variant_display }}</td>
            <td class="t-center">{{ item.qty }}</td>
            <td class="t-right">{{ item.subtotal_display }}</td>
            <td class="t-right">
              {% if o.status == "paid" %}
                {% with dl=item.photo.download_url_for:item.variant %}
                  {% if dl %}
                    <a class="btn" href="{{ dl }}" download>
                      Download ({{ item.get_variant_display }})
                    </a>
                  {% else %}
                    —
                  {% endif %}
                {% endwith %}
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <p><strong>Order Total: {{ o.total_display }}</strong></p>
  </div>
{% empty %}
  <p>You have no orders yet.</p>
{% endfor %}

{% endblock %}
